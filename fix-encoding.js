const fs = require('fs');

// Define encoding fixes as patterns
const encodingFixes = [
    // Common Russian letter fixes
    ['��дми��истрации', 'администрации'],
    ['О��ибка', 'Ошибка'],
    ['Ошиб��а', 'Ошибка'],  
    ['Ошибка', 'Ошибка'],
    ['��лавное', 'главное'],
    ['Глав��ное', 'Главное'],
    ['Главн��е', 'Главное'],
    ['Гла��ное', 'Главное'],
    ['Поль��зователь', 'Пользователь'],
    ['польз��зователя', 'пользователя'],
    ['польз��вателя', 'пользователя'],
    ['по��ьзователей', 'пользователей'],
    ['П��пр��бу��те', 'Попробуйте'],
    ['кан��лов', 'каналов'],
    ['Сообщен���е', 'Сообщение'],
    ['Пригласит��', 'Пригласить'],
    ['О��правлено', 'Отправлено'],
    ['отп��авлено', 'отправлено'],
    ['завер��шена', 'завершена'],
    ['заве��шена', 'завершена'],
    ['пр��верки', 'проверки'],
    ['Про��е��ить', 'Проверить'],
    ['загру��ки', 'загрузки'],
    ['��агрузки', 'загрузки'],
    ['На��ад', 'Назад'],
    ['Наз��д', 'Назад'],
    ['очист��ть', 'очистить'],
    ['упр��вление', 'управление'],
    ['управле��ие', 'управление'],
    ['настрое��', 'настроек'],
    ['стат��стики', 'статистики'],
    ['ста�����истики', 'статистики'],
    ['л��ги', 'логи'],
    ['Л��ги', 'Логи'],
    ['лог��', 'логи'],
    ['Лог��', 'Логи'],
    ['Обнови��ь', 'Обновить'],
    ['П��попробовать', 'Попробовать'],
    ['Поп��об��вать', 'Попробовать'],
    ['��оп��обовать', 'Попробовать'],
    ['выбор���', 'выбора'],
    ['получе��ия', 'получения'],
    ['����налов', 'каналов'],
    ['��лавное', 'главное'],
    ['���арузки', 'загрузки'],
    ['��агрузка', 'загрузка'],
    ['д��нных', 'данных'],
    ['данн��х', 'данных'],
    ['про��ерок', 'проверок'],
    ['пров����ок', 'проверок'],
    ['ист��рии', 'истории'],
    ['уни��альных', 'уникальных'],
    ['у��икальные', 'уникальные'],
    ['кан��лов', 'каналов'],
    ['канало��', 'каналов'],
    ['Не��известный', 'Неизвестный'],
    ['Неизве��тный', 'Неизвестный'],
    ['Уп��авле��и��', 'Управление'],
    ['Ст��тистика', 'Статистика'],
    ['подпис����', 'подписок'],
    ['Ун��кальных', 'Уникальных'],
    ['пользо��ателей', 'пользователей'],
    ['��рошло', 'прошло'],
    ['сч��тается', 'считается'],
    ['��роверка', 'проверка'],
    ['Последн��я', 'Последняя'],
    ['Пос��едние', 'Последние'],
    ['п��льзователе', 'пользователе'],
    ['по��ьзователях', 'пользователях'],
    ['К статис��ике', 'К статистике'],
    ['обрабо��ки', 'обработки'],
    ['требует руч��ой', 'требует ручной'],
    ['А��томатически', 'Автоматически'],
    ['а��томатически', 'автоматически'],
    ['обра��отки', 'обработки'],
    ['Обработа��о', 'Обработано'],
    ['р��чной', 'ручной'],
    ['о��работки', 'обработки'],
    ['сумм������', 'суммы'],
    ['подпис��и', 'подписки'],
    ['уведомлен��ях', 'уведомлениях'],
    ['аг��нта', 'агента'],
    ['лим��тов', 'лимитов'],
    ['лимит��в', 'лимитов'],
    ['лими��ы', 'лимиты'],
    ['дол��ен', 'должен'],
    ['ли��иты', 'лимиты'],
    ['Рекоменда��ии', 'Рекомендации'],
    ['пр��ме��ения', 'применения'],
    ['канала��и', 'каналами'],
    ['пра��в', 'прав'],
    ['пр��в', 'прав'],
    ['н��т', 'нет'],
    ['недель��ых', 'недельных'],
    ['сбро��ены', 'сброшены'],
    ['недел��ных', 'недельных'],
    ['нед��льных', 'недельных'],
    ['распределе��ие', 'распределение'],
    ['д��я', 'для'],
    ['отк��ючена', 'отключена'],
    ['отк��ючен', 'отключен'],
    ['обра��отка', 'обработка'],
    ['Задани��', 'Задание'],
    ['добавл��но', 'добавлено'],
    ['отпра��лены', 'отправлены'],
    ['пол��зователю', 'пользователю'],
    ['зая��ок', 'заявок'],
    ['информа���ию', 'информацию'],
    ['п��льзователе', 'пользователе'],
    ['авт��мат��чески', 'автоматически'],
    ['о��рабатывать', 'обрабатывать'],
    ['��о', 'до'],
    ['����чная', 'ручная'],
    ['пау��а', 'пауза'],
    ['ме��ду', 'между'],
    ['обрабо��ками', 'обработками'],
    ['изме��ения', 'изменения'],
    ['часо��ой', 'часовой'],
    ['��имит', 'лимит'],
    ['ли��ит', 'лимит'],
    ['тести��ования', 'тестирования'],
    ['пе��езапустите', 'перезапустите'],
    ['приме��ения', 'применения'],
    ['упра��ление', 'управление'],
    ['деталь��ые', 'детальные'],
    ['обно��ить', 'обновить'],
    
    // Common emojis that were corrupted
    ['���', '✅'],
    ['��', '🔙'],
    ['���', '🔙'],
    ['����', '📤'],
    ['��', '👤'],
    ['��', '🔄'],
    ['����', '🔄'],
    ['��', '📋'],
    ['��', '🏠'],
    ['����', '🏠'],
    ['��', '👥'],
    ['���', '👥'],
    ['����', '👥'],
    ['��', '📊'],
    ['���', '📊'],
    ['���', '📋'],
    ['��', '📺'],
    ['��', '⚠️'],
    ['��', '🎆'],
    ['��', '🔶'],
    ['��', '🧪'],
    ['��', '📈'],
    ['��', '🎯'],
    ['���', '🤖'],
    ['��', '📅'],
    ['��', '⏰'],
    ['��', '💡'],
    ['���', '🔄'],
    ['��', '▶️'],
    ['��', '⏹️'],
    ['��', '📊'],
    ['��', '🗑️']
];

function fixEncodingInFile(filePath) {
    try {
        let content = fs.readFileSync(filePath, 'utf8');
        let changed = false;
        
        // Apply all encoding fixes
        for (const [corrupted, correct] of encodingFixes) {
            if (content.includes(corrupted)) {
                content = content.replace(new RegExp(corrupted, 'g'), correct);
                changed = true;
                console.log(`Fixed "${corrupted}" -> "${correct}" in ${filePath}`);
            }
        }
        
        if (changed) {
            fs.writeFileSync(filePath, content, 'utf8');
            console.log(`Updated ${filePath}`);
        } else {
            console.log(`No changes needed in ${filePath}`);
        }
        
        return changed;
    } catch (error) {
        console.error(`Error processing ${filePath}:`, error.message);
        return false;
    }
}

// List of files to fix
const filesToFix = [
    'index.js',
    'test-withdrawal-security.js',
    'restore-safe-limits.py',
    'BOT_ADMIN_RIGHTS_EXPLANATION.md',
    'NEW_LOTTERY_DESIGN.md',
    'CAPTCHA_IMPLEMENTATION_REPORT.md',
    'THROTTLING_QUICK_SUMMARY.md',
    'SETUP.md',
    'REFERRAL_LOTTERIES_REPORT.md',
    'REFERRAL_SECURITY_REPORT.md',
    'fix-queue-issues.py',
    'fix-agent-phone.py',
    'STARS_AGENT_GUIDE.md',
    'THROTTLING_FINAL_REPORT.md',
    'FILES_FOR_GIFTS.md',
    'subgram-api.js',
    'BOT_IMPROVEMENTS_PLAN.md',
    'IMPLEMENTATION_REPORT.md',
    'CHANGES_SUMMARY.md',
    'database.js'
];

console.log('Starting encoding fix process...');

let totalFilesChanged = 0;
for (const file of filesToFix) {
    if (fs.existsSync(file)) {
        if (fixEncodingInFile(file)) {
            totalFilesChanged++;
        }
    } else {
        console.log(`File not found: ${file}`);
    }
}

console.log(`\nEncoding fix completed! Changed ${totalFilesChanged} files.`);
