# –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å–æ —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏ SubGram

## üîç –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

–ü–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –±—ã–ª–∞ –≤—ã—è–≤–ª–µ–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:

### –ü—Ä–æ–±–ª–µ–º–∞
1. **SubGram API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `linkedCount: 0`** - –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤
2. **–°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ –¥–æ—Å—Ç—É–ø**, –¥–∞–∂–µ –µ—Å–ª–∏ –∫–∞–Ω–∞–ª–æ–≤ –Ω–µ—Ç (—á—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
3. **–ë–æ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–ª —Å–æ–æ–±—â–µ–Ω–∏—è**, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. **–ö–∞–∂–¥–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ –∫–Ω–æ–ø–∫–∏** –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º

### –ö–æ—Ä–µ–Ω—å –ø—ÄÔøΩÔøΩ–±–ª–µ–º—ã
- –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–ª **–Ω–∞–ª–∏—á–∏–µ –∫–∞–Ω–∞–ª–æ–≤ –≤ –±–∞–∑–µ Neon**, –∞ –Ω–µ **—Å–æ—Å—Ç–æ—è–Ω–∏–µ SubGram API**
- –õ–æ–≥–∏–∫–∞ –Ω–µ —Ä–∞–∑–ª–∏—á–∞–ª–∞ "–Ω–µ—Ç –∫–∞–Ω–∞–ª–æ–≤" –æ—Ç "–µ—Å—Ç—å –∫–∞–Ω–∞–ª—ã, –Ω–æ –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω"
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —É–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π SubGram

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –£–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ SubGram

### –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å: `subgram-smart-handler.js`

#### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:
1. **–ù–ï –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø**, –µ—Å–ª–∏ –Ω–µ—Ç —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤ (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
2. **–ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¢–û–õ–¨–ö–û** –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏
3. **–£–º–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å** —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è SubGram API
4. **Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö - —Ä–∞–∑—Ä–µ—à–∞—Ç—å –¥–æ—Å—Ç—É–ø

### –°–æ—Å—Ç–æ—è–Ω–∏—è SubGram:
```javascript
const SUBGRAM_STATES = {
    NO_CHANNELS: 'no_channels',           // –ù–µ—Ç –∫–∞–Ω–∞–ª–æ–≤ (–Ω–æ—Ä–º–∞)
    HAS_CHANNELS: 'has_channels',         // –ï—Å—Ç—å –∫–∞–Ω–∞–ª—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏
    ALL_SUBSCRIBED: 'all_subscribed',     // –ü–æ–¥–ø–∏—Å–∞–Ω –Ω–∞ –≤—Å–µ
    API_ERROR: 'api_error',               // –û—à–∏–±–∫–∞ API
    DISABLED: 'disabled'                  // SubGram –æ—Ç–∫–ª—é—á–µ–Ω
};
```

### –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π:
```
SubGram API –æ—Ç–≤–µ—Ç ‚Üí –ê–Ω–∞–ª–∏–∑ —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚Üí –†–µ—à–µ–Ω–∏–µ –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ

status='ok' + code=200 ‚Üí ALL_SUBSCRIBED ‚Üí –ù–ï –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ‚úÖ
status='warning' + channels>0 ‚Üí HAS_CHANNELS ‚Üí –ë–õ–û–ö–ò–†–û–í–ê–¢–¨ üö´
status='ok' + channels=0 ‚Üí NO_CHANNELS ‚Üí –ù–ï –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ‚úÖ
–û—à–∏–±–∫–∞ API ‚Üí API_ERROR ‚Üí –ù–ï –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ‚úÖ
–ù–∞—Å—Ç—Ä–æ–π–∫–∏ disabled ‚Üí DISABLED ‚Üí –ù–ï –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å ‚úÖ
```

## üîß –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω —É–º–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `subgram-smart-handler.js`
- `getSubGramState()` - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ SubGram
- `shouldBlockBotAccess()` - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
- `getSubscriptionMessage()` - —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `checkUserSubscriptions()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å–∫–∏ —Å —É—á–µ—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è

### 2. –û–±–Ω–æ–≤–ª–µ–Ω –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª `index.js`
- –ó–∞–º–µ–Ω–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ —É–º–Ω—É—é
- –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `check_subgram_subscriptions`
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/admin_subgram_test`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/smart_subgram_test`

### 3. –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –≤ `/start` –∫–æ–º–∞–Ω–¥–µ:
```javascript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–º–Ω–æ - –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ª–∏ –¥–æ—Å—Ç—É–ø
const subscriptionCheck = await smartSubGram.getSubscriptionMessage(userId);

if (!subscriptionCheck.accessAllowed) {
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
    await bot.sendMessage(chatId, subscriptionCheck.message, {
        reply_markup: { inline_keyboard: subscriptionCheck.buttons }
    });
    return;
} else {
    // –†–∞–∑—Ä–µ—à–∞–µ–º –¥–æ—Å—Ç—É–ø - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    console.log(`User ${userId} has access - proceeding to main menu`);
}
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚ùå –ë–æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –¥–æ—Å—Ç—É–ø –¥–∞–∂–µ –±–µ–∑ –∫–∞–Ω–∞–ª–æ–≤
- ‚ùå –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ñ—É–Ω–∫—Ü–∏–π
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- ‚úÖ –î–æ—Å—Ç—É–ø –ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –µ—Å–ª–∏ –Ω–µ—Ç —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¢–û–õ–¨–ö–û –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±ÔøΩÔøΩ—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π SubGram
- ‚úÖ Fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
```bash
# –û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ—Å—Ç —É–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
/admin_subgram_test

# –î–µ—Ç–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç
/smart_subgram_test

# –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
node test-smart-subgram.js
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
1. **–ï—Å–ª–∏ SubGram –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `linkedCount: 0`**:
   - –°–æ—Å—Ç–æ—è–Ω–∏–µ: `NO_CHANNELS` –∏–ª–∏ `ALL_SUBSCRIBED`
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞: –ù–ï–¢
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –º–æ–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º

2. **–ï—Å–ª–∏ SubGram –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–∞–Ω–∞–ª—ã**:
   - –°–æ—Å—Ç–æ—è–Ω–∏–µ: `HAS_CHANNELS`
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞: –î–ê
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –≤–∏–¥–∏—Ç –∫–∞–Ω–∞–ª—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏

3. **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ API**:
   - –°–æ—Å—Ç–æ—è–Ω–∏–µ: `API_ERROR`
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞: –ù–ï–¢
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –º–æ–∂–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É

1. **–ë–æ–ª—å—à–µ –Ω–µ—Ç –ª–æ–∂–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** - –µ—Å–ª–∏ SubGram –Ω–µ –≤–µ—Ä–Ω—É–ª –∫–∞–Ω–∞–ª—ã, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
2. **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞** - —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏
3. **–£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å API –¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è
4. **–û–¥–Ω–æ–∫—Ä–∞—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### –î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/admin_subgram_test` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —á–µ—Ä–µ–∑ —É–º–Ω—É—é —Å–∏—Å—Ç–µ–º—É

### –î–ª—è –æ—Ç–ª–∞–¥–∫–∏:
- –ö–æ–º–∞–Ω–¥–∞ `/smart_subgram_test` –ø–æ–∫–∞–∂–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `test-smart-subgram.js` –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[SMART-SUBGRAM]`

### –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SubGram –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±–æ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ SubGram —Å —Ç–æ–∫–µ–Ω–æ–º
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ `/admin_subgram_test`
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ SubGram: `/admin_subgram_disable`

## üí° –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —É–º–Ω–æ:
- **–ù–µ –º–µ—à–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º**, –∫–æ–≥–¥–∞ –Ω–µ—Ç —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤
- **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–Ω–∞–ª—ã**, —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω–∏ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –µ—Å—Ç—å
- **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –≥—Ä–∞—Ü–∏–æ–∑–Ω–æ**, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –¥–æ—Å—Ç—É–ø
- **–õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –æ—Ç–ª–∞–¥–∫–∏

–≠—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –æ–ø–∏—Å–∞–Ω–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –∏ –¥–µ–ª–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å SubGram –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–π –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏ –¥—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–π.
