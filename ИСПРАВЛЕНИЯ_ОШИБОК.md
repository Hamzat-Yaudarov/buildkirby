# –û–¢–ß–ï–¢ –û–ë –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø–• –û–®–ò–ë–û–ö

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. üèÜ –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** –†–µ–π—Ç–∏–Ω–≥–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å SQL –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –ª–æ–≥–∏–∫–æ–π

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- **–û–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥ (`handleRatingsAll`)**: 
  - –î–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä `WHERE referrals_count > 0` –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏
  - –£–ª—É—á—à–µ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è –∫–æ–≥–¥–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

- **–ù–µ–¥–µ–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ (`handleRatingsWeek`)**:
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω SQL –∑–∞–ø—Ä–æ—Å —Å `INTERVAL` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
  - –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞: —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ `referrals_count` –≤–º–µ—Å—Ç–æ `referrals_today`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –¢–µ–ø–µ—Ä—å –≤—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 2. üì¢ –û—à–∏–±–∫–∞ –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∞ "‚úèÔ∏è –°–≤–æ—è —Ä–∞—Å—Å—ã–ª–∫–∞" –≤–µ–ª–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é, —Ä–∞—Å—Å—ã–ª–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- **–ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `handleBroadcastCustom`** –≤ `index.js`:
  - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ inline –∫–Ω–æ–ø–∫–∏
  - –û–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏
  - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è

- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π**:
  - –î–æ–±–∞–≤–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–µ `temp_action` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞—Å—Å—ã–ª–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

- **–ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã**:
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ä–∞—Å—Å—ã–ª–∫–∏
  - –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –¢–µ–ø–µ—Ä—å –∫–∞—Å—Ç–æ–º–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —É–¥–æ–±–Ω—ã–π inline –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
1. **`index.js`**:
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handleRatingsWeek`
   - –£–ª—É—á—à–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handleRatingsAll`
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `handleBroadcastCustom`
   - –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ `cancel_broadcast`
   - –î–æ–±–∞–≤–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏

2. **`admin-handlers-final.js`**:
   - –£–¥–∞–ª–µ–Ω–∞ —Å—Ç–∞—Ä–∞—è –Ω–µ—Ä–∞–±–æ—Ç–∞—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è `handleBroadcastCustom`
   - –û–±–Ω–æ–≤–ª—ë–Ω —ç–∫—Å–ø–æ—Ä—Ç –º–æ–¥—É–ª—è

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–µ `temp_action` –≤ —Ç–∞–±–ª–∏—Ü–µ `users` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∫–∏
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å—É—â–µ—ÅÔøΩÔøΩ–≤—É—é—â–µ–π —Å—Ö–µ–º–æ–π –ë–î

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞
- ‚ùå –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**
- ‚úÖ –í—Å–µ —Ä–µ–π—Ç–∏–Ω–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —É–¥–æ–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- ‚úÖ –ë–æ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

## üìù –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö
2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –Ω–æ–≤—ã—Ö –æ—à–∏–±–æ–∫
3. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–ª–µ `temp_action` –æ—á–∏—â–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –£–ö–ê–ó–ê–ù–ù–´–ï –û–®–ò–ë–ö–ò –ò–°–ü–†–ê–í–õ–ï–ù–´
**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** $(date)
**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
