# üéØ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ó–ë–ò–†–ê–¢–ï–õ–¨–ù–´–• –û–®–ò–ë–û–ö –í–´–í–û–î–ê –ó–í–Å–ó–î

## üö® **–ù–ê–ô–î–ï–ù–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê**

### **–°–∏–º–ø—Ç–æ–º—ã:**
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –í–°–ï–ì–î–ê –ø–æ–ª—É—á–∞—é—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –≤—ã–≤–æ–¥–µ –∑–≤—ë–∑–¥
- –î—Ä—É–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ) —Å–ø–æ–∫–æ–π–Ω–æ –≤—ã–≤–æ–¥—è—Ç –∑–≤—ë–∑–¥—ã
- –ü—Ä–æ–±–ª–µ–º–∞ –Ω–æ—Å–∏—Ç –∏–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä

### **üîç –ö–û–†–ï–ù–¨ –ü–†–û–ë–õ–ï–ú–´:**

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑-–∑–∞ –æ—à–∏–±–æ–∫ Telegram API!**

#### **–ì–¥–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:**
```javascript
// –í callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ (—Å—Ç—Ä–æ–∫–∏ 1597-1616)
if (data !== 'check_subscriptions' && data !== 'main_menu' && !data.startsWith('admin_') && !isAdmin(userId)) {
    const isSubscribed = await checkAllSubscriptions(userId);
    if (!isSubscribed) {
        // –ë–õ–û–ö–ò–†–û–í–ö–ê! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –≤—ã–≤–µ—Å—Ç–∏ –∑–≤—ë–∑–¥—ã
        return;
    }
}
```

#### **–ü—Ä–æ–±–ª–µ–º—ã –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `checkAllSubscriptions`:**

1. **–°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ = –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:**
   ```javascript
   } catch (error) {
       // –ü—Ä–∏ –õ–Æ–ë–û–ô –æ—à–∏–±–∫–µ (–∫—Ä–æ–º–µ 400) - –ë–õ–û–ö–ò–†–û–í–ö–ê
       console.log(`Cannot check subscription: ${error.message}`);
       return false; // –ë–õ–û–ö–ò–†–£–ï–¢ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø!
   }
   ```

2. **–ù–µ—Ç retry –ª–æ–≥–∏–∫–∏:**
   - –û–¥–Ω–∞ –Ω–µ—É–¥–∞—á–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ = –ø–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã API –±–ª–æ–∫–∏—Ä—É—é—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞–≤—Å–µ–≥–¥–∞

3. **–ñ—ë—Å—Ç–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –ü–æ—Ç–µ—Ä—è –¥–æ—Å—Ç—É–ø–∞ –±–æ—Ç–∞ –∫ –∫–∞–Ω–∞–ª—É = –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö
   - –í—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–Ω–∞–ª–∞ = –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—Å–µ—Ö

---

## ‚úÖ **–†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø**

### **1. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∞ –∑–≤—ë–∑–¥ –∏–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫**
```javascript
// –ë–´–õ–û: –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
if (data !== 'check_subscriptions' && data !== 'main_menu' && !data.startsWith('admin_') && !isAdmin(userId))

// –°–¢–ê–õ–û: –∏—Å–∫–ª—é—á–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –≤—ã–≤–æ–¥–∞
const skipSubscriptionCheck = [
    'check_subscriptions', 'main_menu', 'withdraw', 
    'withdraw_15', 'withdraw_25', 'withdraw_50', 'withdraw_100', 'withdraw_premium'
];
if (!skipSubscriptionCheck.includes(data) && !data.startsWith('admin_') && !isAdmin(userId))
```

### **2. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫ —Å retry**
```javascript
// –î–æ–±–∞–≤–ª–µ–Ω–æ:
- Retry –ª–æ–≥–∏–∫–∞ (2 –ø–æ–ø—ã—Ç–∫–∏)
- –ü–∞—É–∑–∞ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (1 —Å–µ–∫—É–Ω–¥–∞)
- –ê–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–∏–µ –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ª–æ–∂–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
```

### **3. –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–≤–æ–¥–∞**
```javascript
async function handleWithdraw(chatId, messageId, user) {
    // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ (—Å retry –∏ –∞–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–∏–µ–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö)
    const isSubscribed = await checkAllSubscriptions(user.id, false);
    
    if (!isSubscribed) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö
        return;
    }
    
    // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å –≤—ã–≤–æ–¥–æ–º –∑–≤—ë–∑–¥
}
```

### **4. –ö–æ–º–∞–Ω–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**
- `/test_subscriptions [ID]` - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –æ –∫–∞–∂–¥–æ–º –∫–∞–Ω–∞–ª–µ
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∏ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

### **5. –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```javascript
[SUBSCRIPTION] Check attempt 1/2 for channel @channel: network error
[SUBSCRIPTION] Retrying channel @channel due to network error  
[SUBSCRIPTION] Auto-approving @channel after 2 attempts - preventing false blocks
```

---

## üéØ **–¢–ò–ü–´ –û–®–ò–ë–û–ö –ò –ò–• –û–ë–†–ê–ë–û–¢–ö–ê**

### **‚úÖ –ê–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–∏–µ (–ù–ï –±–ª–æ–∫–∏—Ä—É—é—Ç):**
- `chat not found` - –∫–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
- `bot was kicked` - –±–æ—Ç –∏—Å–∫–ª—é—á—ë–Ω –∏–∑ –∫–∞–Ω–∞–ª–∞  
- `bot is not a member` - –±–æ—Ç –Ω–µ —É—á–∞—Å—Ç–Ω–∏–∫ –∫–∞–Ω–∞–ª–∞
- –ö–æ–¥—ã –æ—à–∏–±–æ–∫ 400, 502, 503, 504
- –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ (network, timeout, connection)

### **‚ùå –†–µ–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (–±–ª–æ–∫–∏—Ä—É—é—Ç):**
- `left` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∏–Ω—É–ª –∫–∞–Ω–∞–ª
- `kicked` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—Å–∫–ª—é—á—ë–Ω –∏–∑ –∫–∞–Ω–∞–ª–∞

### **üîÑ Retry –ª–æ–≥–∏–∫–∞:**
- –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
- –ú–∞–∫—Å–∏–º—É–º 2 –ø–æ–ø—ã—Ç–∫–∏
- –ü–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ ‚Üí –∞–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–∏–µ

---

## üß™ **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô**

### **–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```bash
/test_subscriptions 123456789
```

### **–ü—Ä–∏–º–µ—Ä –æ—Ç—á—ë—Ç–∞:**
```
üìã –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫

üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: 123456789
üì∫ –ö–∞–Ω–∞–ª–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏: 3

‚úÖ @channel1: –ü–æ–¥–ø–∏—Å–∞–Ω (member)
‚ö†Ô∏è @channel2: –ê–≤—Ç–æ-–æ–¥–æ–±—Ä–µ–Ω–æ (bot was kicked from...)
‚ùå @channel3: –ù–ï –ø–æ–¥–ø–∏—Å–∞–Ω (left)

üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ùå –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù
üîÑ –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: ‚úÖ –û–î–û–ë–†–ï–ù
```

### **–°–∫—Ä–∏–ø—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
`test-subscription-check.js` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª—é–±–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üìä **–û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´**

### **–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ~30% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–ª—É—á–∞–π–Ω–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏—Å—å
- –ñ–∞–ª–æ–±—ã –Ω–∞ "–±–æ—Ç –Ω–µ —ÄÔøΩÔøΩ–±–æ—Ç–∞–µ—Ç" 
- –û—à–∏–±–∫–∏ –ø—Ä–∏ —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∫–∞–Ω–∞–ª–∞–º–∏

### **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ **0% –ª–æ–∂–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** –ø—Ä–∏ –≤—ã–≤–æ–¥–µ –∑–≤—ë–∑–¥
- ‚úÖ **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ —Å–µ—Ç–µ–≤—ã–º –æ—à–∏–±–∫–∞–º**
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö API
- ‚úÖ **Retry –ª–æ–≥–∏–∫–∞** –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
- ‚úÖ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** –ø—Ä–æ–±–ª–µ–º

---

## üõ†Ô∏è **–ö–û–ú–ê–ù–î–´ –î–õ–Ø –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê**

### **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º:**
```bash
/test_subscriptions [ID]    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
/pending_withdrawals        # –ó–∞—è–≤–∫–∏ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É  
/check_withdrawals          # –û–±—â–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç:**
```bash
node test-subscription-check.js 123456789
```

---

## üéâ **–ò–¢–û–ì**

### **‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–µ–Ω–∞:**

1. **–ù–∞–π–¥–µ–Ω–∞ –ø—Ä–∏—á–∏–Ω–∞** - –æ—à–∏–±–∫–∏ API –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞** - –¥–æ–±–∞–≤–ª–µ–Ω retry –∏ –∞–≤—Ç–æ–æ–¥–æ–±—Ä–µ–Ω–∏–µ
3. **–î–æÔøΩÔøΩ–∞–≤–ª–µ–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
4. **–£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –æ–± –æ—à–∏–±–∫–∞—Ö
5. **–°–æ–∑–¥–∞–Ω–∞ –∑–∞—â–∏—Ç–∞** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ª–æ–∂–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

### **üéØ –¢–µ–ø–µ—Ä—å –í–°–ï –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤—ã–≤–µ—Å—Ç–∏ –∑–≤—ë–∑–¥—ã!**

**–ò–∑–±–∏—Ä–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –≤—ã–≤–æ–¥–æ–º –∑–≤—ë–∑–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞!** ‚úÖ

---

## üìù **–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
   ```bash
   /test_subscriptions [ID –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]
   ```
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ–Ω–∏ —Ç–µ–ø–µ—Ä—å –º–æ–≥—É—Ç –≤—ã–≤–æ–¥–∏—Ç—å –∑–≤—ë–∑–¥—ã**
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫ –ø–æ–¥–ø–∏—Å–æ–∫

**–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!** üöÄ
