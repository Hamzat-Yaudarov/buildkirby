# Telegram Stars Bot

Telegram бот для заработка звёзд с реферальной системой.

## Функционал

### Пользовательская панель:
- Обязательная подписка на каналы при регистрации
- Профиль с информацией о пользователе
- Реферальная система (3 ⭐️ за каждого друга)
- Ежедневны�� кликер (0.1 ⭐️ в день)
- Система вывода звёзд с отслеживанием (минимум 5 рефералов)
- Задания с автопроверкой подписок
- Рейтинги (общий и за неделю)
- Кейсы для активных пользователей
- Лотереи с билетами
- Промокоды для получения бонусов

### Админ-панель (ID: 6910097562):
- Полная статистика бота (пользователи, активность, баланс)
- Управление заданиями (добавление/удаление)
- Управление обязательными каналами
- Создание и управление лотереями
- Система промокодов
- Рассылка сообщений с throttling (соблюдение лимитов Telegram)
- Мониторинг системы throttling (`/throttler_status`)

## Установка

1. Клонируйте репозиторий
2. Установите зависимости: `npm install`
3. Создайте бота через @BotFather в Telegram
4. Настройте переменные окружения:
   - `BOT_TOKEN` - токен вашего бота
   - `ADMIN_CHANNEL` - канал для уведомлений о выводах (по умолчанию @kirbyvivodstars)
   - `PAYMENTS_CHANNEL` - канал для публичных уведомлений о выполненных выводах (по умолчанию @kirbystarspayments)

## Запуск

### Локально:
```bash
npm start
```

### На Railway:
1. Подключите репозиторий к Railway
2. Установите переменные окружения в настройках проекта
3. Деплойте автоматически через git push

## Настройка

В файле `index.js` настройте:
- `REQUIRED_CHANNELS` - список обязательных каналов для подписки
- `ADMIN_CHANNEL` - канал для административных уведомлений

## База данных

Используется **PostgreSQL** (Neon Database) с автоматическим созданием таблиц при первом запуске.
- Connection pooling для высокой производительности
- Retry логика для стабильности соединения
- Поддержка всех функций бота (рефералы, задания, лотереи, промокоды)

## Система Throttling

Реализована ��родвинутая система управления очередью сообщений для соблюдения лимитов Telegram API:
- **25 сообщений/сек** (90,000 сообщений/час)
- **Умная очередь** с автоматической обработкой
- **Прогресс-трекинг** для массовых рассылок
- **Мониторинг в реальном времени** через `/throttler_status`
- **Исключение блокировок** от Telegram
- **95%+ надёжность** доставки сообщений

### Резервные копии:
- `index-sqlite-backup.js` - версия для SQLite (для локального тестирования)
- `index-postgres-backup.js` - предыдущая PostgreSQL версия
