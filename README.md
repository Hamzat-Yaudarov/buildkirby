# Telegram Stars Bot

Telegram бот для заработка звёзд с реферальной системой и интеграцией SubGram.

## Функционал

### Пользовательская панель:
- **Профиль** - просмотр статистики пользователя
- **Реферальная система** - приглашение друзей за вознаграждение
- **Кликер** - заработок звёзд за клики (до 10 раз в день)
- **Вывод звёзд** - заявки на вывод через админов
- **Задания** - выполнение заданий от SubGram и кастомных
- **Рейтинги** - общий и недельный рейтинг по очкам
- **Кейсы** - ежедневные кейсы за приглашение 5 рефералов
- **Лотере��** - участие в лотереях
- **Промокоды** - активация промокодов

### Админ-панель:
- Статистика бота
- Управление заданиями
- Управление лотереями
- Управление промокодами
- Рассылка сообщений
- Управление недельными наградами
- Обработка заявок на вывод

## Технические детали

### API интеграции:
- **SubGram API** - проверка подписок на спонсорские каналы
- **PostgreSQL (Neon)** - хранение данных
- **Telegram Bot API** - взаимодействие с пользователями

### Система очков:
- За реферала: 2 очка
- За выполненное задание: 1 очко
- За клик: 1 очко
- За билет лотереи: 1 очко

### Награды:
- **Недельный топ 5:**
  - 1 место: 100 звёзд
  - 2 место: 75 звёзд
  - 3 место: 50 звёзд
  - 4 место: 25 звёзд
  - 5 место: 15 звёзд

## Установка

1. Установите зависимости:
```bash
npm install
```

2. Настройте конфигурацию в `config.js`:
   - BOT_TOKEN - токен вашего бота
   - DATABASE_URL - URL PostgreSQL базы данных
   - SUBGRAM_API_KEY - API ключ SubGram
   - ADMIN_IDS - массив ID администраторов

3. Запустите бота:
```bash
npm start
```

## Деплой на Railway

1. Подключите свой GitHub репозиторий к Railway
2. Установите переменные окружения
3. Деплой произойдет автоматически

## Настройка SubGram

1. Добавьте бота в @subgram_officialbot
2. Получите API ключ
3. Укажите ключ в конфигурации

## Структура базы данных

Бот автоматически создает следующие таблицы:
- `users` - пользователи
- `tasks` - задания
- `user_tasks` - выполненные задания
- `promocodes` - промокоды
- `promocode_uses` - использованные промокоды
- `lotteries` - лотереи
- `lottery_tickets` - билеты лотерей
- `withdrawal_requests` - заявки на вывод
- `bot_stats` - статистика бота

## Особенности

- Все кнопки прикреплены к сообщениям
- Бот обновляет сообщения, а не отправляет новые
- Автоматическое начисление недельных наград (воскресенье 20:00 МСК)
- Система антиспама для кликера
- Интеграция с SubGram для проверки подписок

## Каналы для уведомлений

- **@kirbyvivodstars** - обработка заявок на вывод
- **@kirbystarspayments** - уведомления о выполненных выплатах
