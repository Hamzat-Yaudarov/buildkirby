#!/bin/bash

echo "ü§ñ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Stars Agent –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–≤—ë–∑–¥"
echo "============================================================"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Python
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Python..."
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python3 –Ω–µ –Ω–∞–π–¥–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python 3.8+ –¥–ª—è —Ä–∞–±–æ—Ç—ã –∞–≥–µ–Ω—Ç–∞."
    exit 1
fi

PYTHON_VERSION=$(python3 -c 'import sys; print(".".join(map(str, sys.version_info[:2])))')
echo "‚úÖ Python $PYTHON_VERSION –Ω–∞–π–¥–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ pip
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ pip..."
if ! command -v pip3 &> /dev/null; then
    echo "‚ùå pip3 –Ω–µ –Ω–∞–π–¥–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pip –¥–ª—è Python."
    exit 1
fi
echo "‚úÖ pip –Ω–∞–π–¥–µ–Ω"

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Python..."
pip3 install -r requirements.txt

if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π!"
    echo "üí° –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å: pip3 install pyrogram tgcrypto"
    exit 1
fi

echo "‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –∞–≥–µ–Ω—Ç–∞..."
if [ ! -f "userbot-agent.py" ]; then
    echo "‚ùå –§–∞–π–ª userbot-agent.py –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

if [ ! -f "agent-integration.js" ]; then
    echo "‚ùå –§–∞–π–ª agent-integration.js –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    exit 1
fi

echo "‚úÖ –§–∞–π–ª—ã –∞–≥–µ–Ω—Ç–∞ –Ω–∞–π–¥–µ–Ω—ã"

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤
echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤..."
mkdir -p logs
chmod 755 logs

# –°–æ–∑–¥–∞–Ω–∏–µ systemd service (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd service (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)..."
cat > userbot-agent.service << EOF
[Unit]
Description=Telegram Stars Agent
After=network.target

[Service]
Type=simple
User=$(whoami)
WorkingDirectory=$(pwd)
ExecStart=/usr/bin/python3 $(pwd)/userbot-agent.py
Restart=always
RestartSec=10
StandardOutput=append:$(pwd)/logs/agent-stdout.log
StandardError=append:$(pwd)/logs/agent-stderr.log

[Install]
WantedBy=multi-user.target
EOF

echo "‚úÖ Systemd service —Å–æ–∑–¥–∞–Ω: userbot-agent.service"

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
echo ""
echo "‚ö†Ô∏è  –í–ê–ñ–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò:"
echo "----------------------------------------"
echo "1. üîí –ê–≥–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¢–ï–°–¢-–†–ï–ñ–ò–ú–ï (–º–∞–∫—Å–∏–º—É–º 25 –∑–≤—ë–∑–¥ –∑–∞ —Ä–∞–∑)"
echo "2. ‚è∞ –õ–∏–º–∏—Ç—ã: 10 –∑–≤—ë–∑–¥/—á–∞—Å, 80 –∑–≤—ë–∑–¥/–¥–µ–Ω—å"
echo "3. üïí –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ 9:00-23:00 –ú–°–ö"
echo "4. ü§ñ –ß–µ–ª–æ–≤–µ–∫–æ–ø–æ–¥–æ–±–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ 1-3 –º–∏–Ω—É—Ç—ã –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–∞–º–∏"
echo "5. ‚ö†Ô∏è  –†–ò–°–ö –ë–õ–û–ö–ò–†–û–í–ö–ò –ê–ö–ö–ê–£–ù–¢–ê –ø—Ä–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏"
echo ""

# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É
echo "üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–ò –ü–û –ó–ê–ü–£–°–ö–£:"
echo "------------------------"
echo "1. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:"
echo "   python3 userbot-agent.py"
echo ""
echo "2. –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ (–∞–≥–µ–Ω—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):"
echo "   node index.js"
echo ""
echo "3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –±–æ—Ç–∞:"
echo "   /admin -> ü§ñ Stars Agent"
echo ""
echo "4. –†—É—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
echo "   /agent_status - —Å—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞"
echo "   /agent_logs - –ª–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞"
echo "   /send_stars_manual USER_ID AMOUNT - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–≤—ë–∑–¥—ã"
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo "üîß –ü–†–û–í–ï–†–ö–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò:"
echo "------------------------"
echo "API_ID: 28085629"
echo "–ê–∫–∫–∞—É–Ω—Ç: +7972065986 (@kirbystarsagent)"
echo "–¢–µ—Å—Ç-—Ä–µ–∂–∏–º: –í–ö–õ–Æ–ß–Å–ù (–º–∞–∫—Å. 25 –∑–≤—ë–∑–¥)"
echo ""

echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "‚ö° –î–ª—è –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
echo "   python3 userbot-agent.py"
echo ""
echo "üì± –ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–µ—Å—Ç–∏ –∫–æ–¥ –∏–∑ SMS –∏ –≤–æ–∑–º–æ–∂–Ω–æ 2FA –ø–∞—Ä–æ–ª—å"
echo ""
echo "üéØ –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–≤—ë–∑–¥!"
