# üîß –û—Ç—á–µ—Ç –æ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –°–∏—Å—Ç–µ–º—ã –í—ã–≤–æ–¥–∞ –ó–≤—ë–∑–¥

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞–ª–∏ –æ—à–∏–±–∫—É –ø—Ä–∏ –≤—ã–≤–æ–¥–µ –∑–≤—ë–∑–¥:
> "‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏. –í–∞—à–∏ –∑–≤—ë–∑–¥—ã –Ω–µ –±—ã–ª–∏ —Å–ø–∏—Å–∞–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."

–ü—Ä–∏ —ç—Ç–æ–º –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–≥–ª–∏ –≤—ã–≤–æ–¥–∏—Ç—å –∑–≤—ë–∑–¥—ã –±–µ–∑ –ø—Ä–æ–±–ª–µ–º.

## üîç –ê–Ω–∞–ª–∏–∑ –ü—Ä–∏—á–∏–Ω
–û—Å–Ω–æ–≤–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –æ—à–∏–±–æ–∫ –≤ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º–µ:

### 1. –°–ª–æ–∂–Ω–∞—è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –õ–æ–≥–∏–∫–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `BEGIN/COMMIT/ROLLBACK` —Ç—Ä–∞–ΩÔøΩÔøΩ–∞–∫—Ü–∏–π
- –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –û—Ç–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ

### 2. –°—Ç—Ä–æ–≥–∞—è –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ê–¥–º–∏–Ω—Å–∫–æ–≥–æ –ö–∞–Ω–∞–ª–∞
- –ï—Å–ª–∏ –∞–¥–º–∏–Ω—Å–∫–∏–π –∫–∞–Ω–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –æ—Ç–∫–∞—Ç –≤—Å–µ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ —Ç–æ–ª—å–∫–æ –ü–û–°–õ–ï –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –∞–¥–º–∏–Ω—Å–∫–∏–π –∫–∞–Ω–∞–ª
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ ‚Üí —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–µ —Å–ø–∏—Å—ã–≤–∞–ª–∏—Å—å, –Ω–æ –æ—à–∏–±–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞—Å—å

### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –û–±—Ä–∞–±–æ—Ç–∫–∏ –û—à–∏–±–æ–∫
- –î–≤–∞ —É—Ä–æ–≤–Ω—è `try-catch` –±–ª–æ–∫–æ–≤
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –∞–¥–º–∏–Ω—Å–∫–∏–π –∫–∞–Ω–∞–ª
- –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏

### 4. –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –ü—Ä–æ–≤–µ—Ä–∫–∏
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ concurrent requests
- –õ–∏—à–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ"

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –£–ø—Ä–æ—â–µ–Ω–∏–µ –õ–æ–≥–∏–∫–∏ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
**–î–û:**
```javascript
// –°–ª–æ–∂–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞
await db.executeQuery('BEGIN');
try {
    const currentUser = await db.getUser(userId);
    // –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞...
    // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏...
    await bot.sendMessage(ADMIN_CHANNEL, ...); // –ë–õ–û–ö–ò–†–£–Æ–©–ê–Ø –æ–ø–µ—Ä–∞—Ü–∏—è
    await db.updateUserBalance(userId, -amount);
    await db.executeQuery('COMMIT');
} catch (error) {
    await db.executeQuery('ROLLBACK');
    // –û—à–∏–±–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
}
```

**–ü–û–°–õ–ï:**
```javascript
// –ü—Ä–æ—Å—Ç–∞—è –ø—Ä—è–º–∞—è –ª–æ–≥–∏–∫–∞
try {
    // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏
    const withdrawalResult = await db.executeQuery(...);
    // –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
    await db.updateUserBalance(userId, -amount);
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–¥–º–∏–Ω—É (–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è)
    try {
        await bot.sendMessage(ADMIN_CHANNEL, ...);
    } catch (adminError) {
        console.error('Admin channel error:', adminError);
        // –ù–ï –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ø—Ä–æ—Ü–µ—Å—Å
    }
} catch (error) {
    // –ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏
}
```

### 2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ü—Ä–æ–≤–µ—Ä–æ–∫
‚úÖ **–û–°–¢–ê–í–õ–ï–ù–û:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ 5 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤: `if (user.referrals_count < 5)`
- –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –∞–¥–º–∏–Ω—Å–∫–∏–π –∫–∞–Ω–∞–ª: `await bot.sendMessage(ADMIN_CHANNEL, ...)`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞: `if (parseFloat(user.balance) < amount)`

### 3. –£–±—Ä–∞–Ω–Ω—ã–µ –õ–∏—à–Ω–∏–µ –ü—Ä–æ–≤–µ—Ä–∫–∏
‚ùå **–£–î–ê–õ–ï–ù–û:**
- –°–ª–æ–∂–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ BEGIN/COMMIT/ROLLBACK
- –î–≤–æ–π–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ concurrent requests
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –∫–∞–Ω–∞–ª–∞
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ try-catch –±–ª–æ–∫–æ–≤
- –õ–∏—à–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ"

### 4. –£–ª—É—á—à–µ–Ω–Ω–∞—è –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫
**–ü—Ä–∏–Ω—Ü–∏–ø:** –û–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è, –¥–∞–∂–µ –µ—Å–ª–∏ –∞–¥–º–∏–Ω—Å–∫–∏–π –∫–∞–Ω–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

```javascript
// –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ –∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ —Å–ø–∏—Å–∞–Ω—ã
try {
    await bot.sendMessage(ADMIN_CHANNEL, adminMessage, {...});
} catch (adminError) {
    console.error('[WITHDRAWAL] Error sending to admin channel:', adminError.message);
    // –ù–ï –û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ü–†–û–¶–ï–°–° - –∑–∞—è–≤–∫–∞ —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞!
}
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ù–æ–≤ÔøΩÔøΩ–≥–æ –ü–æ–¥—Ö–æ–¥–∞
‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∞–¥–º–∏–Ω—Å–∫–∏–º –∫–∞–Ω–∞–ª–æ–º  
‚úÖ **–°–∫–æ—Ä–æ—Å—Ç—å:** –£–±—Ä–∞–Ω–∞ –∏–∑–±—ã—Ç–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏  
‚úÖ **–ü–æ–Ω—è—Ç–Ω–æ—Å—Ç—å:** –ö–æ–¥ —Å—Ç–∞–ª –ø—Ä–æ—â–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏  

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 5 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ  
‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –∞–¥–º–∏–Ω—Å–∫–∏–π –∫–∞–Ω–∞–ª —Ä–∞–±–æ—Ç–∞—é—Ç  
‚úÖ **–ë–∞–ª–∞–Ω—Å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è  

## üöÄ –î–µ–ø–ª–æ–π

### –°—Ç–∞—Ç—É—Å
- ‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω –∏ —É–ø—Ä–æ—â–µ–Ω
- ‚úÖ –ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–≤–æ–¥ —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—É–º–º–∞–ºÔøΩÔøΩ (15, 25, 50, 100, 1300)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –±–∞–ª–∞–Ω—Å–µ
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ < 5 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
4. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∞–¥–º–∏–Ω—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –°–≤–æ–¥–∫–∞

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –§—É–Ω–∫—Ü–∏–∏
- `handleWithdrawRequest()` - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞

### –°—Ç—Ä–æ–∫–∏ –ö–æ–¥–∞
- **–£–¥–∞–ª–µ–Ω–æ:** ~50 —Å—Ç—Ä–æ–∫ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
- **–î–æ–±–∞–≤–ª–µ–Ω–æ:** ~30 —Å—Ç—Ä–æ–∫ –ø—Ä–æ—Å—Ç–æ–π –ª–æ–≥–∏–∫–∏
- **–ß–∏—Å—Ç—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** -20 —Å—Ç—Ä–æ–∫, +100% –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

### –õ–æ–≥–∏–∫–∞ –ò–∑–º–µ–Ω–µ–Ω–∏–π
```
–°–¢–ê–†–ê–Ø: –ü—Ä–æ–≤–µ—Ä–∫–∏ ‚Üí –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Üí –ê–¥–º–∏–Ω –∫–∞–Ω–∞–ª ‚Üí –°–ø–∏—Å–∞–Ω–∏–µ ‚Üí –ö–æ–º–º–∏—Ç
–ù–û–í–ê–Ø:  –ü—Ä–æ–≤–µ—Ä–∫–∏ ‚Üí –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ ‚Üí –°–ø–∏—Å–∞–Ω–∏–µ ‚Üí –ê–¥–º–∏–Ω –∫–∞–Ω–∞–ª (async)
```

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** üîÑ –ì–û–¢–û–í–û –ö –ü–†–û–í–ï–†–ö–ï  
**–î–∞—Ç–∞:** $(date)
