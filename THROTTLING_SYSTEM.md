# –°–∏—Å—Ç–µ–º–∞ Throttling –¥–ª—è Telegram Bot

## –û–±–∑–æ—Ä

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Å–∏—Å—Ç–µ–º–∞ throttling –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ Telegram API:
- **–õ–∏–º–∏—Ç Telegram:** 30 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
- **–ù–∞—à–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:** 25 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∑–∞–ø–∞—Å)
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª:** 40ms –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –£–º–Ω–∞—è –æ—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—å—é
- –°–æ–±–ª—é–¥–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
- Retry logic –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### ‚úÖ Broadcast —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-—Ç—Ä–µ–∫–∏–Ω–≥–æ–º
- –ú–∞—Å—Å–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º throttling
- Callback –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–ΩÔøΩÔøΩ—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö/–Ω–µ—É–¥–∞—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### ‚úÖ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- Throttling –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –æ–ø—Ü–∏–π Telegram API

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–º–ø–æ—Ä—Ç
```javascript
const { throttler } = require('./message-throttler');
```

### –û–¥–∏–Ω–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
```javascript
await throttler.sendMessage(() => 
    bot.sendMessage(userId, message, options)
);
```

### –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
```javascript
const result = await throttler.broadcastMessages(
    users,
    (user) => bot.sendMessage(user.id, message, options),
    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π callback –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    async (progress) => {
        console.log(`–ü—Ä–æ–≥—Ä–µ—Å—Å: ${progress.percentage}%`);
    }
);
```

### –°—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏
```javascript
const status = throttler.getStatus();
console.log('–°–æ–æ–±—â–µ–Ω–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏:', status.queueLength);
```

## –ì–¥–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ

### üì¢ –†–∞—Å—Å—ã–ª–∫–∏ (Broadcast)
- `broadcastLotteryResults()` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ª–æ—Ç–µ—Ä–µ–π
- `handleBroadcastTasks()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–¥–∞–Ω–∏—è—Ö  
- `handleBroadcastReferrals()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞—Ö
- `/custom_broadcast` –∫–æ–º–∞–Ω–¥–∞
- –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### üí¨ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –≤—ã–≤–æ–¥–æ–≤
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏ –≤—ã–≤–æ–¥–æ–≤
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–∞—Ö

## –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### `/throttler_status`
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã throttling:
```
üìä –°—Ç–∞—Ç—É—Å Throttler

üì® –û—á–µ—Ä–µ–¥—å —Å–æ–æ–±—â–µ–Ω–∏–π: 0
‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç–∫–∞: –ù–µ–∞–∫—Ç–∏–≤–Ω–∞
‚è±Ô∏è –°–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É: 25
‚è∞ –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏: 40ms

‚úÖ –û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã throttler
```javascript
new MessageThrottler(25) // 25 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–°–æ–æ–±—â–µ–Ω–∏–π –≤ —Å–µ–∫—É–Ω–¥—É:** 25
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª:** 40ms
- **–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏:** –î–∞
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:** –ö–∞–∂–¥—ã–µ 10 —Å–æ–æ–±—â–µ–Ω–∏–π

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
- –ù–∏–∫–∞–∫–∏—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –æ—Ç Telegram
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rate limiting

### ‚úÖ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Retry –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö
- Graceful degradation

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API
- –ü—Ä–æ–≥—Ä–µ—Å—Å-—Ç—Ä–µ–∫–∏–Ω–≥ –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –°—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º `[THROTTLER]`:
```
[THROTTLER] Initialized with 25 messages/sec (40ms interval)
[THROTTLER] Starting queue processing, 156 messages queued
[THROTTLER] 100 messages remaining in queue
[THROTTLER] Queue processing completed
[THROTTLER] Broadcast completed: 145/156 successful, 11 errors
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏:** –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:** –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–ø—É—Å–∫
- **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫
- **API –æ—à–∏–±–∫–∏:** Graceful handling

## –ü—Ä–æ–∏–∑–≤–æÔøΩÔøΩ–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–î–æ throttling:** –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ > 30 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫
- **–ü–æ—Å–ª–µ throttling:** –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 24/7
- **Throughput:** 25 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫ = 90,000 —Å–æ–æ–±—â–µ–Ω–∏–π/—á–∞—Å
- **–ü–∞–º—è—Ç—å:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
**–î–∞—Ç–∞:** $(date)
