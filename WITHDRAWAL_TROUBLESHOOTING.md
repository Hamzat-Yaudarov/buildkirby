# üõ†Ô∏è –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å –≤—ã–≤–æ–¥–æ–º –∑–≤—ë–∑–¥

## üö® –ü—Ä–æ–±–ª–µ–º–∞: "–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞—è–≤–∫–∏. –í–∞—à–∏ –∑–≤—ë–∑–¥—ã –Ω–µ –±—ã–ª–∏ —Å–ø–∏—Å–∞–Ω—ã"

### üìã –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

#### 1. **–ü—Ä–æ–±–ª–µ–º—ã —Å –∞–¥–º–∏–Ω—Å–∫–∏–º –∫–∞–Ω–∞–ª–æ–º (–Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞)**
- –ë–æ—Ç –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∞–¥–º–∏–Ω—Å–∫–∏–π –∫–∞–Ω–∞–ª `@kirbyvivodstars`
- –ë–æ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —É–¥–∞–ª—ë–Ω –∏–∑ –∫–∞–Ω–∞–ª–∞
- –£ –±–æ—Ç–∞ –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π

#### 2. **–ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π ID –∏–ª–∏ –∏–º—è –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –∫–∞–Ω–∞–ª–∞
- –ü—Ä–æ–±–ª–µ–º—ã —Å —ÇÔøΩÔøΩ–∫–µ–Ω–æ–º –±–æ—Ç–∞

#### 3. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**
- –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å API Telegram
- –û—à–∏–±–∫–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### **–®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤**
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞ –∏ –Ω–∞–π–¥–∏—Ç–µ –≤ –ª–æ–≥–∞—Ö —Å—Ç—Ä–æ–∫–∏:
```
[WITHDRAWAL] CRITICAL ERROR in transaction for user XXXXX:
[WITHDRAWAL] Error type: Error
[WITHDRAWAL] Error message: ...
```

### **–®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –∫–æ–º–∞–Ω–¥**

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –≤—ã–≤–æ–¥–∞:
```
/withdrawal_diagnostics
```
–ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –∫–∞–Ω–∞–ª–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞—è–≤–æ–∫.

#### –¢–µ—Å—Ç –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –∫–∞–Ω–∞–ª–∞:
```
/test_admin_channel
```
–ü–æ–ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∞–¥–º–∏–Ω—Å–∫–∏–π –∫–∞–Ω–∞–ª.

### **–®–∞–≥ 3: –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞**
```bash
node test-admin-channel.js
```
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### **–ü—Ä–æ–±–ª–µ–º–∞: Chat not found**
```
[WITHDRAWAL] Admin channel not found or bot not added: @kirbyvivodstars
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–∞–Ω–∞–ª `@kirbyvivodstars` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º—è –∫–∞–Ω–∞–ª–∞ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `ADMIN_CHANNEL`
3. –ï—Å–ª–∏ –∫–∞–Ω–∞–ª –ø—Ä–∏–≤–∞—Ç–Ω—ã–π, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ chat_id –≤–º–µ—Å—Ç–æ username

### **–ü—Ä–æ–±–ª–µ–º–∞: Forbidden**
```
[WITHDRAWAL] Bot forbidden in admin channel: @kirbyvivodstars
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –∞–¥–º–∏–Ω—Å–∫–∏–π –∫–∞–Ω–∞–ª –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
   - –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–Ω–∞–ª `@kirbyvivodstars`
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
   - –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ `@kirby_stars_bot`
   - –î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π

### **–ü—Ä–æ–±–ª–µ–º–∞: Message too long**
```
[WITHDRAWAL] Message too long error
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–±–ª–µ–º–∞ –≤ –¥–ª–∏–Ω–Ω–æ–º –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ username
2. –§—É–Ω–∫—Ü–∏—è `cleanDisplayText()` –¥–æ–ª–∂–Ω–∞ –æ–±—Ä–µ–∑–∞—Ç—å –¥–ª–∏–Ω–Ω—ã–µ –∏–º–µ–Ω–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Telegram API (4096 —Å–∏–º–≤–æ–ª–æ–≤)

### **–ü—Ä–æ–±–ª–µ–º–∞: Database errors**
```
[WITHDRAWAL] Error type: DatabaseError
```

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `withdrawal_requests` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î

## üéØ –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### **–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–∞:**
```bash
# –í Telegram –±–æ—Ç–µ:
/withdrawal_diagnostics  # –û–±—â–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
/test_admin_channel     # –¢–µ—Å—Ç –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –∫–∞–Ω–∞–ª–∞

# –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:
node test-admin-channel.js  # –ü–æ–¥—Ä–æ–±–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–Ω–∞–ª–∞
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
echo $BOT_TOKEN           # –¢–æ–∫–µ–Ω –±–æ—Ç–∞
echo $ADMIN_CHANNEL       # –ö–∞–Ω–∞–ª –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (@kirbyvivodstars)
echo $PAYMENTS_CHANNEL    # –ö–∞–Ω–∞–ª –¥–ª—è –≤—ã–ø–ª–∞—Ç (@kirbystarspayments)
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **–õ–æ–≥–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:**
- `‚úÖ Bot has access to admin channel` - –∫–∞–Ω–∞–ª –¥–æ—Å—Ç—É–ø–µ–Ω
- `‚ùå Cannot access admin channel` - –ø—Ä–æ–±–ª–µ–º—ã —Å –∫–∞–Ω–∞–ª–æ–º  
- `[WITHDRAWAL] Admin notification sent successfully` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
- `[WITHDRAWAL] FAILED to send admin notification` - –æ—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

### **SQL –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```sql
-- –ó–∞—è–≤–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞
SELECT status, COUNT(*) 
FROM withdrawal_requests 
WHERE created_at > NOW() - INTERVAL '24 hours'
GROUP BY status;

-- –ù–µ–¥–∞–≤–Ω–∏–µ –∑–∞—è–≤–∫–∏ —Å –æ—à–∏–±–∫–∞–º–∏ (–µ—Å–ª–∏ –±—ã —É –Ω–∞—Å –±—ã–ª —Å—Ç–∞—Ç—É—Å 'error')
SELECT * FROM withdrawal_requests 
WHERE status = 'pending' 
AND created_at < NOW() - INTERVAL '1 hour';
```

## üöÄ –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞

### **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
1. **–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ:** –¢–µ—Å—Ç `/test_admin_channel`
2. **–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª–µ
3. **–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:** –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ `/withdrawal_diagnostics`

### **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞:**
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö
2. –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ pending –∑–∞—è–≤–æ–∫
3. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –∫–∞–Ω–∞–ª–∞

## üìû –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑–æ–≤—ã–µ –≤–µ—â–∏:**
   - –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ò–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ
   - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞

2. **–ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –∞–¥–º–∏–Ω—Å–∫–∏–π –∫–∞–Ω–∞–ª:**
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–∞–Ω–∞–ª
   - –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –∫–∞–∫ –∞–¥–º–∏–Ω–∞
   - –û–±–Ω–æ–≤–∏—Ç–µ `ADMIN_CHANNEL` –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

3. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∑–∞ –ø–æ–º–æ—â—å—é:**
   - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –ª–æ–≥–∏ —Å –æ—à–∏–±–∫–∞–º–∏
   - –£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–æ–±–ª–µ–º–æ–π
   - –û–ø–∏—à–∏—Ç–µ –∫–æ–≥–¥–∞ –Ω–∞—á–∞–ª–∞—Å—å –ø—Ä–æ–±–ª–µ–º–∞

---
*–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º —Å–≤—è–∑–∞–Ω–æ —Å –ø—Ä–∞–≤–∞–º–∏ –±–æ—Ç–∞ –≤ –∞–¥–º–∏–Ω—Å–∫–æ–º –∫–∞–Ω–∞–ª–µ! ü§ñ*
