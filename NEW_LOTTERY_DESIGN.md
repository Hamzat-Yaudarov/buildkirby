# –î–∏–∑–∞–π–Ω –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –ª–æ—Ç–µ—Ä–µ–π

## üéØ –î–≤–∞ –Ω–æ–≤—ã—Ö —Ç–∏–ø–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –ª–æ—Ç–µ—Ä–µ–π

### **–¢–∏–ø 1: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –ª–æ—Ç–µ—Ä–µ–∏ —Å —É—Å–ª–æ–≤–∏–µ–º —É—á–∞—Å—Ç–∏—è**
- **–£—Å–ª–æ–≤–∏–µ —É—á–∞—Å—Ç–∏—è**: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å N —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –∑–∞ N —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ª–æ—Ç–µ—Ä–µ–∏
- **–ë–∏–ª–µ—Ç—ã**: 1 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –±–∏–ª–µ—Ç + –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤
- **–ü—Ä–∏–∑—ã**: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∞–¥–º–∏–Ω–æ–º (—Ä–∞–∑–Ω—ã–µ —Å—É–º–º—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç)
- **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–Ω–µ –ø–æ –±–∏–ª–µ—Ç–∞–º)
- **–í—ã–±–æ—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π**: –≤—Ä—É—á–Ω—É—é –∞–¥–º–∏–Ω–æ–º

### **–¢–∏–ø 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –ª–æ—Ç–µ—Ä–µ–∏**
- **–£—á–∞—Å—Ç–∏–µ**: –∫–∞–∂–¥—ã–π –Ω–æ–≤—ã–π —Ä–µ—Ñ–µ—Ä–∞–ª –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ = +1 –±–∏–ª–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–ë–∏–ª–µ—Ç—ã**: —Ç–æ–ª—å–∫–æ –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (–Ω–µ –ø–æ–∫—É–ø–∞—é—Ç—Å—è)
- **–ü—Ä–∏–∑—ã**: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∞–¥–º–∏–Ω–æ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—Ç–∞
- **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ**: –ø–æ –≤—Ä–µ–º–µ–Ω–∏
- **–í—ã–±–æ—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π**: –≤—Ä—É—á–Ω—É—é –∞–¥–º–∏–Ω–æ–º

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `lotteries`**
–î–æ–±–∞–≤–∏–º –ø–æ–ª–µ `lottery_type`:
- `'standard'` - –æ–±—ã—á–Ω–∞—è –ª–æ—Ç–µ—Ä–µ—è (—Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)
- `'referral_condition'` - —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å —É—Å–ª–æ–≤–∏–µ–º (—Ç–∏–ø 1)
- `'referral_auto'` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è (—Ç–∏–ø 2)

### **–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `referral_lotteries`**
```sql
CREATE TABLE referral_lotteries (
    id SERIAL PRIMARY KEY,
    lottery_id INTEGER REFERENCES lotteries(id) ON DELETE CASCADE,
    
    -- –£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è (–¥–ª—è —Ç–∏–ø–∞ 1)
    required_referrals INTEGER,          -- –°–∫–æ–ª—å–∫–æ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –Ω—É–∂–Ω–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å
    referral_time_hours INTEGER,         -- –ó–∞ —Å–∫–æ–ª—å–∫–æ —á–∞—Å–æ–≤ –Ω—É–∂–Ω–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å
    
    -- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–∏–ª–µ—Ç–æ–≤ (–¥–ª—è —Ç–∏–ø–∞ 1)
    additional_ticket_price DECIMAL(10,2), -- –¶–µ–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –±–∏–ª–µ—Ç–∞
    
    -- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    ends_at TIMESTAMP NOT NULL,          -- –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –ª–æ—Ç–µ—Ä–µ–∏
    
    -- –°—Ç–∞—Ç—É—Å
    is_manual_selection BOOLEAN DEFAULT TRUE, -- –†—É—á–Ω–æ–π –≤—ã–±–æ—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π
    winners_selected BOOLEAN DEFAULT FALSE,   -- –í—ã–±—Ä–∞–Ω—ã –ª–∏ –ø–æ–±–µ–¥–∏—Ç–µ–ª–∏
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### **–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `lottery_prizes`**
```sql
CREATE TABLE lottery_prizes (
    id SERIAL PRIMARY KEY,
    lottery_id INTEGER REFERENCES lotteries(id) ON DELETE CASCADE,
    place INTEGER NOT NULL,              -- –ü—Ä–∏–∑–æ–≤–æ–µ –º–µ—Å—Ç–æ (1, 2, 3...)
    prize_amount DECIMAL(10,2) NOT NULL, -- –†–∞–∑–º–µ—Ä –ø—Ä–∏–∑–∞ –≤ –∑–≤–µ–∑–¥–∞—Ö
    winner_user_id BIGINT DEFAULT NULL,  -- ID –ø–æ–±–µ–¥–∏—Ç–µ–ª—è (NULL –ø–æ–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω)
    awarded_at TIMESTAMP DEFAULT NULL,   -- –í—Ä–µ–º—è –ø—Ä–∏—Å—É–∂–¥–µ–Ω–∏—è –ø—Ä–∏–∑–∞
    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### **–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `referral_lottery_tickets`**
```sql
CREATE TABLE referral_lottery_tickets (
    id SERIAL PRIMARY KEY,
    lottery_id INTEGER REFERENCES lotteries(id) ON DELETE CASCADE,
    user_id BIGINT NOT NULL,
    ticket_type VARCHAR(20) NOT NULL,    -- 'free', 'purchased', 'referral'
    referral_user_id BIGINT DEFAULT NULL, -- ID —Ä–µ—Ñ–µ—Ä–∞–ª–∞ (–¥–ª—è —Ç–∏–ø–∞ 2)
    purchased_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### **–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `lottery_participants`**
```sql
-- –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏ –∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
CREATE TABLE lottery_participants (
    id SERIAL PRIMARY KEY,
    lottery_id INTEGER REFERENCES lotteries(id) ON DELETE CASCADE,
    user_id BIGINT NOT NULL,
    
    -- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–∞
    total_tickets INTEGER DEFAULT 0,     -- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤
    free_tickets INTEGER DEFAULT 0,      -- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –±–∏–ª–µ—Ç—ã
    purchased_tickets INTEGER DEFAULT 0, -- –ö—É–ø–ª–µ–Ω–Ω—ã–µ –±–∏–ª–µ—Ç—ã
    referral_tickets INTEGER DEFAULT 0,  -- –ë–∏–ª–µ—Ç—ã –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
    
    -- –£—Å–ª–æ–≤–∏—è —É—á–∞—Å—Ç–∏—è (–¥–ª—è —Ç–∏–ø–∞ 1)
    referrals_count INTEGER DEFAULT 0,   -- –°–∫–æ–ª—å–∫–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
    qualified BOOLEAN DEFAULT FALSE,     -- –í—ã–ø–æ–ª–Ω–∏–ª –ª–∏ —É—Å–ª–æ–≤–∏–µ —É—á–∞—Å—Ç–∏—è
    
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    UNIQUE(lottery_id, user_id)
);
```

## üéÆ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### **–¢–∏–ø 1: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ª–æ—Ç–µ—Ä–µ—è —Å —É—Å–ª–æ–≤–∏–µ–º**

**–°–æ–∑–¥–∞–Ω–∏–µ:**
```
/create_referral_lottery –Ω–∞–∑–≤–∞–Ω–∏–µ|–≤—Ä–µ–º—è_—á–∞—Å–æ–≤|–º–∏–Ω_—Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤|—Ü–µ–Ω–∞_–±–∏–ª–µ—Ç–∞|–º–µ—Å—Ç–æ1:–ø—Ä–∏–∑1|–º–µ—Å—Ç–æ2:–ø—Ä–∏–∑2|...
```

**–ü—Ä–∏–º–µ—Ä:**
```
/create_referral_lottery –ù–µ–¥–µ–ª—å–Ω–∞—è|168|3|1.5|1:50|2:30|3:20
```
- –ù–∞–∑–≤–∞–Ω–∏–µ: "–ù–µ–¥–µ–ª—å–Ω–∞—è"
- –í—Ä–µ–º—è: 168 —á–∞—Å–æ–≤ (–Ω–µ–¥–µ–ª—è)
- –£—Å–ª–æ–≤–∏–µ: –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å 3 —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- –¶–µ–Ω–∞ –¥–æ–ø. –±–∏–ª–µ—Ç–∞: 1.5 ‚≠ê
- –ü—Ä–∏–∑—ã: 1 –º–µ—Å—Ç–æ - 50‚≠ê, 2 –º–µ—Å—Ç–æ - 30‚≠ê, 3 –º–µ—Å—Ç–æ - 20‚≠ê

**–£—á–∞—Å—Ç–∏–µ:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å N —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è
2. –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —É—Å–ª–æ–≤–∏—è –ø–æ–ª—É—á–∞–µ—Ç 1 –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –±–∏–ª–µ—Ç
3. –ú–æ–∂–µ—Ç –∫—É–ø–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∏–ª–µ—Ç—ã –∑–∞ –∑–≤–µ–∑–¥—ã

### **–¢–∏–ø 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ª–æ—Ç–µ—Ä–µ—è**

**–°–æ–∑–¥–∞–Ω–∏–µ:**
```
/create_auto_referral_lottery –Ω–∞–∑–≤–∞–Ω–∏–µ|–≤—Ä–µ–º—è_—á–∞—Å–æ–≤|–º–µ—Å—Ç–æ1:–ø—Ä–∏–∑1|–º–µ—Å—Ç–æ2:–ø—Ä–∏–∑2|...
```

**–ü—Ä–∏–º–µ—Ä:**
```
/create_auto_referral_lottery –ê–≤—Ç–æ|72|1:100|2:60|3:40|4:20|5:10
```
- –ù–∞–∑–≤–∞–Ω–∏–µ: "–ê–≤—Ç–æ"
- –í—Ä–µ–º—è: 72 —á–∞—Å–∞ (3 –¥–Ω—è)
- –ü—Ä–∏–∑—ã: 1-100‚≠ê, 2-60‚≠ê, 3-40‚≠ê, 4-20‚≠ê, 5-10‚≠ê

**–£—á–∞—Å—Ç–∏–µ:**
1. –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π —Ä–µ—Ñ–µ—Ä–∞–ª –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –ª–æ—Ç–µ—Ä–µ–∏ = +1 –±–∏–ª–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. –ë–∏–ª–µ—Ç—ã –Ω–µ –ø–æ–∫—É–ø–∞—é—Ç—Å—è, —Ç–æ–ª—å–∫–æ –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

## üèÜ –°–∏—Å—Ç–µ–º–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π

### **–†—É—á–Ω–æ–π –≤—ã–±–æ—Ä –∞–¥–º–∏–Ω–æ–º:**
```
/select_lottery_winners ID –º–µ—Å—Ç–æ1:userID –º–µ—Å—Ç–æ2:userID –º–µ—Å—Ç–æ3:userID
```

**–ü—Ä–∏–º–µ—Ä:**
```
/select_lottery_winners 5 1:123456 2:789012 3:345678
```

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ:

```
üéâ **–õ–æ—Ç–µ—Ä–µ—è "–ù–µ–¥–µ–ª—å–Ω–∞—è" –∑–∞–≤–µ—Ä—à–µ–Ω–∞!**

üèÜ **–ü–æ–±–µ–¥–∏—Ç–µ–ª–∏:**
ü•á 1 –º–µ—Å—Ç–æ: @username1 - 50 ‚≠ê
ü•à 2 –º–µ—Å—Ç–æ: @username2 - 30 ‚≠ê  
ü•â 3 –º–µ—Å—Ç–æ: @username3 - 20 ‚≠ê

–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π! üéä
```

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π

1. **–†–∞—Å—à–∏—Ä—è–µ–º** —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ç–∞–±–ª–∏—Ü—É `lotteries` –ø–æ–ª–µ–º `lottery_type`
2. **–°–æ—Ö—Ä–∞–Ω—è–µ–º** –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ª–æ—Ç–µ—Ä–µ–π
3. **–î–æ–±–∞–≤–ª—è–µ–º** –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —ÅÔøΩÔøΩ—â–µ—Å—Ç–≤—É—é—â–∏—Ö
4. **–ò—Å–ø–æ–ª—å–∑—É–µ–º** —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–∏—Å—Ç–µ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –±–∞–ª–∞–Ω—Å–æ–≤
