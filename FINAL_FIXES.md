# –ò—Ç–æ–≥–æ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞ SubGram

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –≤ /start
**–ü—Ä–æ–±–ª–µ–º–∞:** –î–∞–∂–µ –ø—Ä–∏ `isSubscribed: false` –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è –≥–ª–∞–≤–Ω—ã–π –º–∞–Ω—É–∞–ª
**–†–µ—à–µ–Ω–∏–µ:** 
- –£–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å—Å—ã–ª–æ–∫ –≤ —É—Å–ª–æ–≤–∏–∏
- –¢–µ–ø–µ—Ä—å –ø—Ä–∏ `!isSubscribed` –í–°–ï–ì–î–ê –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø
- –î–æ–±–∞–≤–ª–µ–Ω–æ fallback —Å–æ–æ–±—â–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç —Å—Å—ã–ª–æ–∫ –∫–∞–Ω–∞–ª–æ–≤

```javascript
// –î–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
if (!subscriptionStatus.isSubscribed && subscriptionStatus.subscriptionData?.links?.length > 0)

// –ü–û–°–õ–ï (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
if (!subscriptionStatus.isSubscribed)
```

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 404 –æ—à–∏–±–∫–∏ –æ—Ç SubGram
**–ü—Ä–æ–±–ª–µ–º–∞:** 404 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º "–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–µ–π" –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –∫–∞–∫ –æ—à–∏–±–∫–∞
**–†–µ—à–µ–Ω–∏–µ:** 
- 404 —Å —ç—Ç–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å "ok"
- –û–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤ (—Ä–∞–∑—Ä–µ—à–µ–Ω –¥–æ—Å—Ç—É–ø)

### 3. –û—à–∏–±–∫–∞ Markdown –ø–∞—Ä—Å–∏–Ω–≥–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** `[–ü—Ä–æ—Ñ–∏–ª—å](tg://user?id=...)` –≤—ã–∑—ã–≤–∞–ª–∞ –æ—à–∏–±–∫—É –ø–∞—Ä—Å–∏–Ω–≥–∞
**–†–µ—à–µ–Ω–∏–µ:** 
- –£–±—Ä–∞–Ω–∞ Markdown —Å—Å—ã–ª–∫–∞, –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ—Å—Ç–∞—è —Å—Å—ã–ª–∫–∞
- –£–±—Ä–∞–Ω `parse_mode: 'Markdown'`

### 4. –ü—Ä–æ–±–ª–µ–º–∞ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–æ–æ–±—â–µ–Ω–∏–π
**–†–µ—à–µ–Ω–∏–µ:** –ß–µ—Ç–∫–∞—è –ª–æ–≥–∏–∫–∞ –≤ /start - –ª–∏–±–æ —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏–µ –∫–∞–Ω–∞–ª—ã, –ª–∏–±–æ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ö–æ–º–∞–Ω–¥–∞ /start:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ `checkUserSubscription()`
2. –ï—Å–ª–∏ `isSubscribed: false` ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏–µ –∫–∞–Ω–∞–ª—ã –ò–õ–ò —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ
3. –ï—Å–ª–∏ `isSubscribed: true` ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
4. **–ù–ï–¢** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–≤—É—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ SubGram:
- `status: "ok"` ‚Üí –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω
- `status: "warning"` ‚Üí –ù–ï –ø–æ–¥–ø–∏—Å–∞–Ω, –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫–∏ –∫–∞–Ω–∞–ª–æ–≤
- `status: "error"` ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–µ—à –∫–∞–∫ fallback
- `404 "–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–µ–π"` ‚Üí –Ω–µ—Ç —Å–ø–æ–Ω—Å–æ—Ä–æ–≤, —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø

### Callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –í–°–ï–• –∫–æ–º–∞–Ω–¥ (–∫—Ä–æ–º–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π)
- –ü—Ä–∏ –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ—Å—Ç–∏ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥

## üìä –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –ø–æ–¥–ø–∏—Å–∞–Ω:
1. `/start` ‚Üí –¢–û–õ–¨–ö–û —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏–µ –∫–∞–Ω–∞–ª—ã
2. –õ—é–±–∞—è –∫–Ω–æ–ø–∫–∞ ‚Üí –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏–µ –∫–∞–Ω–∞–ª—ã
3. –§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–Ω:
1. `/start` ‚Üí –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
2. –í—Å–µ –∫–Ω–æ–ø–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ
3. –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ —Ñ—É–Ω–∫—Ü–∏—è–º

### –ù–µ—Ç —Å–ø–æ–Ω—Å–æ—Ä–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
1. SubGram –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 "–ù–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–µ–π"
2. –°—Ç–∞—Ç—É—Å: –ø–æ–¥–ø–∏—Å–∞–Ω (–¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω)
3. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

## üöÄ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –¢–µ—Å—Ç –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –ö–æ–º–∞–Ω–¥–∞ `/start` –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å –¢–û–õ–¨–ö–û —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏–µ –∫–∞–Ω–∞–ª—ã
- –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- –õ—é–±–∞—è –∫–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–º–µ–Ω—è—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª—ã

### 2. –¢–µ—Å—Ç –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –ö–æ–º–∞–Ω–¥–∞ `/start` –¥–æ–ª–∂–Ω–∞ –ø–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
- –í—Å–µ –∫–Ω–æ–ø–∫–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å

### 3. –¢–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ —Å–ø–æ–Ω—Å–æ—Ä–æ–≤:
- –ï—Å–ª–∏ SubGram –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 ‚Üí –¥–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

### 4. –¢–µ—Å—Ç –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π:
- –ó–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥ –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ–π, –Ω–µ Markdown

## üîç –õ–æ–≥–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–æ–≥–∏:
```
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å XXX –ø–æ–¥–ø–∏—Å–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
üîí –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å XXX –ù–ï –ø–æ–¥–ø–∏—Å–∞–Ω, –±–ª–æ–∫–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø
‚ÑπÔ∏è SubGram: –Ω–µ—Ç —Å–ø–æ–Ω—Å–æ—Ä–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è XXX
```

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –ª–æ–≥–∏ (–Ω–µ –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è):
```
‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏: ReferenceError: startTime is not defined
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å XXX –ø–æ–¥–ø–∏—Å–∞–Ω –∏–ª–∏ –Ω–µ—Ç —Å–ø–æ–Ω—Å–æ—Ä–æ–≤ (–ø—Ä–∏ isSubscribed: false)
can't parse entities: Can't find end of the entity
```

## üåê –í–µ–±—Ö—É–∫ –ø—Ä–æ–≤–µ—Ä–∫–∞

URL: `https://buildkirby-production.up.railway.app/webhook/subgram`

### GET –∑–∞–ø—Ä–æ—Å (–±—Ä–∞—É–∑–µ—Ä):
```json
{
  "error": "Endpoint not found",
  "method": "GET", 
  "availableEndpoints": {...}
}
```
**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! GET –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è.**

### POST –∑–∞–ø—Ä–æ—Å (–æ—Ç SubGram):
- –î–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `200 OK`
- API –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è
- –í–µ–±—Ö—É–∫–∏ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–ª—è—Ç—å –∫–µ—à –ø–æ–¥–ø–∏—Å–æ–∫

## ‚ö° –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

1. **index.js:227-282** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ /start
2. **index.js:705-727** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º–∏–Ω—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ  
3. **subgram.js:44-66** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ 404 –∫–∞–∫ "–Ω–µ—Ç —Å–ø–æ–Ω—Å–æ—Ä–æ–≤"
4. **subgram.js:120-145** - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è getTaskChannels
5. **subgram.js:173-195** - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è getChannelLinks

–¢–µ–ø–µ—Ä—å –±–æ—Ç –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ! üéâ
