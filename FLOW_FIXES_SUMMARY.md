# –°–≤–æ–¥–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –ø–æ—ç—Ç–∞–ø–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–æ–∫

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–∫–∞–∑—ã–≤–∞–ª–∏—Å—å –≤—Å–µ –∫–∞–Ω–∞–ª—ã —Å—Ä–∞–∑—É
**‚úÖ –†–µ—à–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å—Ç—Ä–æ–≥–∏–π –ø–æ—ç—Ç–∞–ø–Ω—ã–π flow:
- **–≠—Ç–∞–ø 1:** –¢–æ–ª—å–∫–æ —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏–µ –∫–∞–Ω–∞–ª—ã –æ—Ç SubGram
- **–≠—Ç–∞–ø 2:** –¢–æ–ª—å–∫–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–ø–æ–Ω—Å–æ—Ä–æ–≤  
- **–≠—Ç–∞–ø 3:** –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –ø–æ—Å–ª–µ –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–æ–∫

### 2. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
**‚úÖ –†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- –ö–æ—ÄÔøΩÔøΩ–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–ø–∏—Å–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

### 3. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
**‚úÖ –†–µ—à–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞:
- –û–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —ç—Ç–∞–ø
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏
- –ù–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞

## üéØ –ù–æ–≤—ã–π flow –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```
/start ‚Üí –ö–∞–ø—á–∞ ‚Üí 
‚Üì
–ï—Å—Ç—å —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏–µ –∫–∞–Ω–∞–ª—ã? 
‚îú‚îÄ –î–ê: –ü–æ–∫–∞–∑–∞—Ç—å –¢–û–õ–¨–ö–û —Å–ø–æ–Ω—Å–æ—Ä–æ–≤ ‚Üí "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–æ–Ω—Å–æ—Ä–æ–≤"
‚îÇ      ‚Üì (–ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏)
‚îÇ      –ï—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã?
‚îÇ      ‚îú‚îÄ –î–ê: –ü–æ–∫–∞–∑–∞—Ç—å –¢–û–õ–¨–ö–û –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ ‚Üí "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ"  
‚îÇ      ‚îÇ      ‚Üì (–ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏)
‚îÇ      ‚îÇ      –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ ‚úÖ
‚îÇ      ‚îî‚îÄ –ù–ï–¢: –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ ‚úÖ
‚îî‚îÄ –ù–ï–¢: –ï—Å—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã?
       ‚îú‚îÄ –î–ê: –ü–æ–∫–∞–∑–∞—Ç—å –¢–û–õ–¨–ö–û –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ ‚Üí "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ"
       ‚îÇ      ‚Üì (–ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏)  
       ‚îÇ      –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ ‚úÖ
       ‚îî‚îÄ –ù–ï–¢: –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ ‚úÖ
```

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

### üÜï –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `subscription-flow-manager.js` - –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—ç—Ç–∞–ø–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
- `test-stage-flow.js` - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—ç—Ç–∞–ø–Ω–æ–≥–æ flow

### üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `index.js` - –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ /start –∏ callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
  - –ù–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏: `check_sponsors`, `check_required`
  - –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è: `handleStageBasedSubscriptionCheck`
  - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π

## üîò –ù–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏:

- **"‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–æ–Ω—Å–æ—Ä–æ–≤"** (`check_sponsors`) - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–æ–Ω—Å–æ—Ä—Å–∫–∏—Ö –∫–∞–Ω–∞–ª–æ–≤
- **"‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ"** (`check_required`) - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
- –°—Ç–∞—Ä–∞—è –∫–Ω–æ–ø–∫–∞ `check_subscriptions_enhanced` –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É

## üîí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π:

**–î–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –í–°–ï–• —ç—Ç–∞–ø–æ–≤ –ø–æ–¥–ø–∏—Å–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã:**
- –ö–ª–∏–∫–µ—Ä, –∑–∞–¥–∞–Ω–∏—è, –≤—ã–≤–æ–¥ –∑–≤—ë–∑–¥
- –ü—Ä–æ—Ñ–∏–ª—å, —Ä–µ—Ñ–µ—Ä–∞–ª—ã, –∫–µ–π—Å—ã, –ª–æ—Ç–µ—Ä–µ—è
- –í—Å–µ –≤–∞–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞

**–†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫ (`check_sponsors`, `check_required`)
- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (`main_menu`)
- –ö–∞–ø—á–∞ (`new_captcha`)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
node test-stage-flow.js
```

## üìä SubGram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:

- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç SubGram API
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–æ–≤ –≤ –ë–î —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ username –∏–∑ —Å—Å—ã–ª–æ–∫ t.me/
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–æ–¥–ø–∏—Å–∫–∏

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç:

‚úÖ **–ü–æ—ç—Ç–∞–ø–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç:** –°–ø–æ–Ω—Å–æ—Ä—ã ‚Üí –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ ‚Üí –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é  
‚úÖ **–ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:** –û–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —ç—Ç–∞–ø  
‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫  
‚úÖ **–ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:** –§—É–Ω–∫—Ü–∏–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤
