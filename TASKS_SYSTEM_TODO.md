# –ó–∞–¥–∞—á–∞: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –∑–∞–¥–∞–Ω–∏–π –≤ Telegram –±–æ—Ç–µ

## üéØ –¶–µ–ª—å
–ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é "–ó–∞–¥–∞–Ω–∏—è" –≤ –±–æ—Ç–µ, —á—Ç–æ–±—ã –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å SubGram API.

## üìã –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞
–°–µ–π—á–∞—Å –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ó–∞–¥–∞–Ω–∏—è" –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–∏–±–æ –æ—à–∏–±–∫—É, –ª–∏–±–æ "–Ω–µ—Ç –∑–∞–¥–∞–Ω–∏–π". –ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ç–∞–∫, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è —Ä–æ–≤–Ω–æ 1 –∫–∞–Ω–∞–ª –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –ø–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞—á–∏—Å–ª—è–ª–æ—Å—å 0.3 –∑–≤–µ–∑–¥—ã + 1 –æ—á–∫–æ.

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### 1. –§—É–Ω–∫—Ü–∏—è showTasks() –≤ index.js
**–ú–µ—Å—Ç–æ:** –æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 790-850 –≤ index.js
**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `SubGram.getTaskChannels()` –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–ª–∏ –æ—à–∏–±–∫—É
**–†–µ—à–µ–Ω–∏–µ:** 
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SubGram.checkSubscription()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–∞–Ω–∞–ª–æ–≤
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¢–û–õ–¨–ö–û –ø–µ—Ä–≤—ã–π –∫–∞–Ω–∞–ª –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–∞–∫ –∑–∞–¥–∞–Ω–∏–µ
- –ï—Å–ª–∏ –∫–∞–Ω–∞–ª–æ–≤ –Ω–µ—Ç, –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π"

### 2. –õ–æ–≥–∏–∫–∞ –ø–æ–∫–∞–∑–∞ –∑–∞–¥–∞–Ω–∏–π
**–¢–µ–∫—É—â–∏–π –∫–æ–¥ –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π:**
```javascript
async function showTasks(chatId, userId, messageId) {
    const subgramTask = await SubGram.getTaskChannels(userId, chatId);
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–∏–±–æ –æ—à–∏–±–∫—É, –ª–∏–±–æ "–Ω–µ—Ç –∑–∞–¥–∞–Ω–∏–π"
}
```

**–ù—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞:**
```javascript
async function showTasks(chatId, userId, messageId) {
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const subscriptionCheck = await SubGram.checkSubscription(userId, chatId);
    
    // 2. –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –∫–∞–∫ –∑–∞–¥–∞–Ω–∏–µ
    if (subscriptionCheck.links && subscriptionCheck.links.length > 0) {
        const taskLink = subscriptionCheck.links[0]; // –¢–û–õ–¨–ö–û –ø–µ—Ä–≤—ã–π –∫–∞–Ω–∞–ª
        const sponsor = subscriptionCheck.additional?.sponsors?.[0];
        const channelName = sponsor?.resource_name || '–ö–∞–Ω–∞–ª';
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–ü–µ—Ä–µ–π—Ç–∏" –∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ"
    } else {
        // –ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π
    }
}
```

### 3. –§—É–Ω–∫—Ü–∏—è handleTaskCheck() –≤ index.js
**–ú–µ—Å—Ç–æ:** –æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 1420-1470 –≤ index.js
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∫–∞–Ω–∞–ª—ã —Å—Ä–∞–∑—É
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∑–∞–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –≤ –ë–î —á—Ç–æ —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ
- –ù–∞—á–∏—Å–ª—è—Ç—å 0.3 –∑–≤–µ–∑–¥—ã + 1 –æ—á–∫–æ
- –í—ã–∑—ã–≤–∞—Ç—å `checkReferralConditions(userId)` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π

### 4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π –æ—Ç SubGram
**–†–µ—à–µ–Ω–∏–µ:**
–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∏–ª–∏ –ø–æ–ª–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö SubGram –∑–∞–¥–∞–Ω–∏–π:
```sql
-- –õ–∏–±–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ user_tasks:
INSERT INTO user_tasks (user_id, task_id, subgram_link) VALUES (userId, -1, taskLink);

-- –õ–∏–±–æ —Å–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É:
CREATE TABLE subgram_tasks (
    id SERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    channel_link VARCHAR(500) NOT NULL,
    completed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## üìù –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –®–∞–≥ 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å showTasks()
1. –ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é `showTasks()` –≤ index.js (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 790)
2. –ó–∞–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `SubGram.checkSubscription()` –≤–º–µ—Å—Ç–æ `getTaskChannels()`
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ü–ï–†–í–´–ô –∫–∞–Ω–∞–ª –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã—Ö
   - –ï—Å–ª–∏ –∫–∞–Ω–∞–ª–æ–≤ –Ω–µ—Ç - –ø–æ–∫–∞–∑–∞—Ç—å "–ù–µ—Ç –∑–∞–¥–∞–Ω–∏–π"

### –®–∞–≥ 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å handleTaskCheck()
1. –ù–∞–π—Ç–∏ —Ñ—É–Ω–∫—Ü–∏—é `handleTaskCheck()` –≤ index.js (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫–∏ 1420)
2. –ò–∑–º–µ–Ω–∏—Ç—å –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–ø–∏—Å–∞–ª—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–∞–Ω–∞–ª-–∑–∞–¥–∞–Ω–∏–µ
   - –ó–∞–ø–∏—Å–∞—Ç—å –≤ –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ
   - –ù–∞—á–∏—Å–ª–∏—Ç—å –Ω–∞–≥—Ä–∞–¥—É (0.3 –∑–≤–µ–∑–¥—ã + 1 –æ—á–∫–æ)
   - –í—ã–∑–≤–∞—Ç—å `checkReferralConditions(userId)`

### –®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏–π –≤ –ë–î
1. –î–æ–±–∞–≤–∏—Ç—å —Å–ø–æ—Å–æ–± –∑–∞–ø–∏—Å–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö SubGram –∑–∞–¥–∞–Ω–∏–π
2. –ü—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –∑–∞–¥–∞–Ω–∏–π, –∫–∞–∫–∏–µ –∫–∞–Ω–∞–ª—ã —É–∂–µ –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∫–∞–∫ –∑–∞–¥–∞–Ω–∏—è

### –®–∞–≥ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –ù–∞–∂–∞—Ç—å "–ó–∞–¥–∞–Ω–∏—è" - –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è 1 –∫–∞–Ω–∞–ª
2. –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∫–∞–Ω–∞–ª –∏ –Ω–∞–∂–∞—Ç—å "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å" 
3. –î–æ–ª–∂–Ω–æ –Ω–∞—á–∏—Å–ª–∏—Ç—å—Å—è 0.3 –∑–≤–µ–∑–¥—ã + 1 –æ—á–∫–æ
4. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –Ω–∞–∂–∞—Ç–∏–∏ "–ó–∞–¥–∞–Ω–∏—è" –¥–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–∏–π –∫–∞–Ω–∞–ª

## üîç –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **index.js** - —Ñ—É–Ω–∫—Ü–∏–∏ `showTasks()` –∏ `handleTaskCheck()`
2. **database.js** - –≤–æ–∑–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è SubGram –∑–∞–¥–∞–Ω–∏–π
3. **subgram.js** - —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

## üö® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- SubGram –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –í–°–ï –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã —á–µ—Ä–µ–∑ `checkSubscription()`
- –ù—É–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏—Ö –ø–æ –æ–¥–Ω–æ–º—É –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
- –ö–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ = 0.3 –∑–≤–µ–∑–¥—ã + 1 –æ—á–∫–æ
- –ó–∞–¥–∞–Ω–∏—è –¥–æ–ª–∂–Ω—ã —É—á–∏—Ç—ã–≤–∞—Ç—å—Å—è –≤ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ (2 –∑–∞–¥–∞–Ω–∏—è –¥–ª—è –∑–∞—Å—á–∏—Ç—ã–≤–∞–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–∞)

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
- –ö–Ω–æ–ø–∫–∞ "–ó–∞–¥–∞–Ω–∏—è" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 1 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–∞–Ω–∞–ª
- –ü–æ—Å–ª–µ –ø–æ–¥–ø–∏—Å–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏: +0.3 –∑–≤–µ–∑–¥—ã, +1 –æ—á–∫–æ
- –°–ª–µ–¥—É—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π –∫–∞–Ω–∞–ª
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å—á–∏—Ç–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- `index.js` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- `database.js` - —Ñ—É–Ω–∫—Ü–∏–∏ –ë–î
- `subgram.js` - API SubGram (—É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω)
- `REFERRAL_AND_DUPLICATION_FIXES.md` - –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
